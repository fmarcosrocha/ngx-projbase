<mat-toolbar class="mat-elevation-z4 mat-white lib-toolbar-top">
  <mat-toolbar-row style="height: 60px;" [ngClass]="{ 'nav-shrink' : shrink }">
    <img alt="" class="img-title" src="./assets/images/logo.png" />
    <mat-divider [vertical]="true" style="margin: 2px 16px; height: 70%;"></mat-divider>
    <div class="navbar-title" *ngIf="!isSmallScreen">
      Título Principal
    </div>
    <span class="lib-spacer"></span>

    <ng-container *ngIf="notificacao && notificacao.total > 0">
      <button mat-button mat-icon-button color="primary" class="mr-3" aria-label="Notificações" [matMenuTriggerFor]="menuNotificacao">
        <i matBadge="{{ notificacao.total }}" matBadgeColor="warn" class="fa fa-comment fa-2" aria-hidden="true"></i>
      </button>

      <mat-menu #menuNotificacao="matMenu" xPosition="before">

        <ng-container *ngIf="notificacao.menus && notificacao.menus.length > 0; then temMenu; else naoTemMenu;"></ng-container>
        <ng-template #temMenu>
          <ng-container *ngIf="notificacao.menus && notificacao.menus.length > 0">
            <a mat-menu-item *ngFor="let item of notificacao.menus" [routerLink]="item.uri">{{ item.titulo }}</a>
          </ng-container>
        </ng-template>
        <ng-template #naoTemMenu>
          <button mat-menu-item>
            Nenhum menu configurado
          </button>
        </ng-template>

      </mat-menu>
    </ng-container>

    <ng-container *ngIf="isSmallScreen; then simpleBar; else fullBar"></ng-container>

    <!--componente do avatar...-->
    <ng-template #usuarioAvatar>
      <ng-template #avatarComImagem>
        <img mat-card-avatar src="{{usuario.imagemAvatar}}" alt="Avatar"/>
      </ng-template>
      <ng-template #avatarSemImagem>
        <div *ngIf="usuario && usuario.initial" mat-card-avatar class="bg-success text-white">
          <span>{{usuario.initial.toUpperCase()}}</span>
        </div>
        <mat-icon style="font-size: 36px;" *ngIf="!usuario || !usuario.initial" role="img" mat-card-avatar>person</mat-icon>
      </ng-template>
      <ng-container *ngIf="usuario.imagemAvatar; then avatarComImagem else avatarSemImagem"></ng-container>
    </ng-template>

    <ng-template #simpleBar>
      <button mat-button mat-icon-button color="primary" class="mr-3" aria-label="Menu" [matMenuTriggerFor]="menuCompleto">
        <mat-icon>apps</mat-icon>
      </button>
      <mat-menu #menuCompleto="matMenu" xPosition="before">
        <ng-container *ngIf="!logado && exibirLogin">
          <button mat-menu-item (click)="login.emit()">
            <div class="d-flex">
              <mat-icon class="mr-3">person</mat-icon>
              <span>Entrar</span>
            </div>
          </button>

          <mat-divider></mat-divider>
        </ng-container>

        <ng-container *ngIf="versoes && versoes.length > 0; else unicaVersaoM;">
          <button mat-menu-item *ngFor="let versao of versoes">
            <div class="d-flex">
              <mat-icon class="mr-3 material-icons-outlined">{{ versao.icone }}</mat-icon>
              <span>{{ versao.versao }}</span>
              <mat-chip-list class="ml-3" *ngIf="label">
                <mat-chip color="warn" selected>{{ versao.label }}</mat-chip>
              </mat-chip-list>
            </div>
          </button>
        </ng-container>
        <ng-template #unicaVersaoM>
          <button mat-menu-item>
            <div class="d-flex">
              <mat-icon class="mr-3 material-icons-outlined">info</mat-icon>
              <span>{{ versao }}</span>
              <mat-chip-list class="ml-3" *ngIf="label">
                <mat-chip color="warn" selected>{{ label }}</mat-chip>
              </mat-chip-list>
            </div>
          </button>
        </ng-template>
      </mat-menu>
      <ng-container *ngIf="logado && exibirLogin">
        <ng-container *ngTemplateOutlet="usuarioAvatar"></ng-container>

        <button mat-button mat-icon-button color="primary" aria-label="Usuário" [matMenuTriggerFor]="usuarioMenu">
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
        <mat-menu #usuarioMenu="matMenu" xPosition="before" class="mat-menu-panel-login">

          <ng-container *ngIf="usuario && usuario.uri; else hasNotUri">
            <a mat-menu-item [routerLink]="usuario.uri" [ngStyle]="{'height': exibirRoles ? '80px' : '58px'}">
              <div style="min-width: 250px;"><!--468px-->
                <p style="margin: 0; line-height: 25px; font-weight: bold;">{{ usuario ? usuario.firstName + ' ' + usuario.lastName : '' }}</p>
                <p style="margin: 0; line-height: 25px;"><small>{{ usuario ? usuario.email : '' }}</small></p>
                <p style="margin: 0; line-height: 25px;" *ngIf="exibirRoles"><small>{{ getRoles() }}</small></p>
              </div>
            </a>
          </ng-container>
          <ng-template #hasNotUri>
            <a mat-menu-item [ngStyle]="{'height': exibirRoles ? '80px' : '58px'}">
              <div style="min-width: 250px;"><!--468px-->
                <p style="margin: 0; line-height: 25px; font-weight: bold;">{{ usuario ? usuario.firstName + ' ' + usuario.lastName : '' }}</p>
                <p style="margin: 0; line-height: 25px;"><small>{{ usuario ? usuario.email : '' }}</small></p>
                <p style="margin: 0; line-height: 25px;" *ngIf="exibirRoles"><small>{{ getRoles() }}</small></p>
              </div>
            </a>
          </ng-template>

          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logoff.emit()">
            <div class="d-flex">
              <mat-icon class="mr-3">logout</mat-icon>
              <span>Sair</span>
            </div>
          </button>
        </mat-menu>
      </ng-container>

    </ng-template>
    <ng-template #fullBar>

      <ng-container *ngIf="versoes && versoes.length > 0; else unicaVersao;">

        <button mat-button mat-icon-button color="primary" class="mr-3" aria-label="Informação" [matMenuTriggerFor]="menu">
          <i class="fa fa-info fa-2" aria-hidden="true"></i>
        </button>
        <mat-menu #menu="matMenu" xPosition="before">
          <button mat-menu-item *ngFor="let versao of versoes">
            <div class="d-flex">
              <mat-icon class="mr-3 material-icons-outlined">{{ versao.icone }}</mat-icon>
              <span>{{ versao.versao }}</span>
              <mat-chip-list class="ml-3" *ngIf="label">
                <mat-chip color="warn" selected>{{ versao.label }}</mat-chip>
              </mat-chip-list>
            </div>
          </button>
        </mat-menu>

      </ng-container>
      <ng-template #unicaVersao>

        <button mat-button mat-icon-button color="primary" class="mr-3" aria-label="Informação" [matMenuTriggerFor]="menu">
          <i class="fa fa-info fa-2" aria-hidden="true"></i>
        </button>
        <mat-menu #menu="matMenu" xPosition="before">
          <button mat-menu-item>
            <div class="d-flex">
              <mat-icon class="mr-3 material-icons-outlined">info</mat-icon>
              <span>{{ versao }}</span>
              <mat-chip-list class="ml-3" *ngIf="label">
                <mat-chip color="warn" selected>{{ label }}</mat-chip>
              </mat-chip-list>
            </div>
          </button>
        </mat-menu>

      </ng-template>

      <button *ngIf="!logado && exibirLogin" mat-button color="primary" (click)="login.emit()">
        <div class="d-flex">
          <mat-icon class="mr-3">person</mat-icon>
          <span>Entrar</span>
        </div>
      </button>

      <ng-container *ngIf="logado && exibirLogin">
        <ng-container *ngTemplateOutlet="usuarioAvatar"></ng-container>

        <button mat-button mat-icon-button color="primary" class="mr-3" aria-label="Usuário" [matMenuTriggerFor]="usuarioMenu">
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
        <mat-menu #usuarioMenu="matMenu" xPosition="before" class="mat-menu-panel-login">

          <ng-container *ngIf="usuario && usuario.uri; else hasNotUri1">
            <a mat-menu-item [routerLink]="usuario.uri" [ngStyle]="{'height': exibirRoles ? '80px' : '58px'}">
              <div style="min-width: 350px;"><!--468px-->
                <p style="margin: 0; line-height: 25px; font-weight: bold;">{{ usuario ? usuario.firstName + ' ' + usuario.lastName : '' }}</p>
                <p style="margin: 0; line-height: 25px;"><small>{{ usuario ? usuario.email : '' }}</small></p>
                <p style="margin: 0; line-height: 25px;" *ngIf="exibirRoles"><small>{{ getRoles() }}</small></p>
              </div>
            </a>
          </ng-container>
          <ng-template #hasNotUri1>
            <a mat-menu-item [ngStyle]="{'height': exibirRoles ? '80px' : '58px'}">
              <div style="min-width: 350px;"><!--468px-->
                <p style="margin: 0; line-height: 25px; font-weight: bold;">{{ usuario ? usuario.firstName + ' ' + usuario.lastName : '' }}</p>
                <p style="margin: 0; line-height: 25px;"><small>{{ usuario ? usuario.email : '' }}</small></p>
                <p style="margin: 0; line-height: 25px;" *ngIf="exibirRoles"><small>{{ getRoles() }}</small></p>
              </div>
            </a>
          </ng-template>

          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logoff.emit()">
            <div class="d-flex">
              <mat-icon class="mr-3">logout</mat-icon>
              <span>Sair</span>
            </div>
          </button>
        </mat-menu>
      </ng-container>

    </ng-template>
  </mat-toolbar-row>

  <mat-toolbar-row style="align-items: flex-start; height: 79px;">
    <button *ngIf="exibirMenu" mat-button mat-icon-button color="primary" aria-label="Abrir menu" class="icon-menu"
      (click)="abrirMenu.emit()">
      <mat-icon class="primary">menu</mat-icon>
    </button>
    <div class="overflow-hidden">
      <p class="ma-0 mat-subheading-2 text-primary">Organização LTDA</p>
      <p class="ma-0 mat-subheading-1 overflow-text-ellipsis">{{ secretaria }}</p>
      <p class="ma-0 mat-subheading-1 overflow-text-ellipsis">{{ sistema }}</p>
    </div>
    <span class="lib-spacer"></span>
  </mat-toolbar-row>
</mat-toolbar>
